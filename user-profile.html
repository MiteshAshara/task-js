<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Profile</title>
  <link rel="icon" type="image/x-icon" href="https://cdn-icons-png.flaticon.com/512/5968/5968292.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <div class="navbar-brand d-flex align-items-center">
        <div id="profileAvatar"
          class="rounded-circle bg-secondary text-white fw-bold d-flex align-items-center justify-content-center me-3"
          style="width: 50px; height: 50px; font-size: 18px">
        </div>
        <div>
          <h6 id="profileName" class="mb-0">Loading...</h6>
          <small id="profileEmail" class="text-muted">Loading...</small>
        </div>
      </div>
    </div>
  </nav>

  <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel">Edit Profile</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="profileForm">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Name</label>
                <input type="text" name="name" class="form-control" />
              </div>
              <div class="col-md-6">
                <label class="form-label">College</label>
                <select name="college" class="form-select">
                  <option>RK University, Rajkot</option>
                  <option>Marwadi University, Rajkot</option>
                  <option>Atmiya University, Rajkot</option>
                  <option>Gujarat Technological University, Ahmedabad</option>
                  <option>Nirma University, Ahmedabad</option>
                  <option>Adani University, Ahmedabad</option>
                  <option>CEPT University, Ahmedabad</option>
                  <option>Ganpat University, Ahmedabad</option>
                  <option>Karnavati University, Ahmedabad</option>
                  <option>Indus University, Ahmedabad</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">College Branch</label>
                <select name="college_branch" class="form-select">
                  <option>B.Tech Computer Engineering</option>
                  <option>B.Tech Information Technology</option>
                  <option>B.Tech Mechanical Engineering</option>
                  <option>B.Tech Civil Engineering</option>
                  <option>B.Com</option>
                  <option>MCA</option>
                  <option>MSCIT</option>
                  <option>MBA</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Date of Birth</label>
                <input type="date" name="DOB" class="form-control" id="dob" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Age</label>
                <input type="text" name="age" class="form-control" id="age" disabled />
              </div>
              <div class="col-md-6">
                <label class="form-label">College Joining Date</label>
                <input type="date" name="clg_joining_date" class="form-control" id="joining" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Passing Year</label>
                <input type="number" name="passing_year" class="form-control" id="passing" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Gender</label>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="gender" value="Male" id="male" checked />
                  <label class="form-check-label" for="male">Male</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="gender" value="Female" id="female" />
                  <label class="form-check-label" for="female">Female</label>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Email</label>
                <input type="email" name="email" class="form-control" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Mobile</label>
                <input type="tel" name="mobile" class="form-control" maxlength="10" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Hobbies</label>
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" name="hobbies" value="Reading" id="hobbyReading" />
                  <label class="form-check-label" for="hobbyReading">Reading</label>
                </div>
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" name="hobbies" value="Music" id="hobbyMusic" />
                  <label class="form-check-label" for="hobbyMusic">Music</label>
                </div>
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" name="hobbies" value="Travelling" id="hobbyTravelling" />
                  <label class="form-check-label" for="hobbyTravelling">Travelling</label>
                </div>
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" name="hobbies" value="Photography" id="hobbyPhotography" />
                  <label class="form-check-label" for="hobbyPhotography">Photography</label>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Country</label>
                <select name="country" class="form-select">
                  <option>India</option>
                  <option>USA</option>
                  <option>UK</option>
                </select>
              </div>
              <div class="col-md-3">
                <label for="city" class="form-label">City</label>
                <input list="cityOptions" id="city" name="city" class="form-control" maxlength="10" />
                <datalist id="cityOptions">
                  <option value="Rajkot"></option>
                  <option value="Gujarat"></option>
                  <option value="Ahmedabad"></option>
                </datalist>
              </div>
              <div class="col-md-6">
                <label for="state" class="form-label">State</label>
                <input list="stateOptions" id="state" name="state" class="form-control" maxlength="10" />
                <datalist id="stateOptions">
                  <option value="Rajkot"></option>
                  <option value="Gujarat"></option>
                  <option value="Ahmedabad"></option>
                </datalist>
              </div>
              <div class="col-md-3">
                <label class="form-label">Pincode</label>
                <input type="text" name="pincode" class="form-control" />
              </div>
              <div class="col-md-6">
                <label for="address" class="form-label">Address</label>
                <textarea id="address" name="address" class="form-control"></textarea>
              </div>
              <div class="col-md-6">
                <label class="form-label">Profile Image</label>
                <input type="file" name="image" class="form-control" id="imageUpload" accept="image/*" />
                <div class="mt-2 d-flex align-items-center gap-3">
                  <img id="previewImage" src="" alt="Preview" class="rounded-circle border"
                    style="width: 60px; height: 60px; display: none" />
                  <button type="button" class="btn btn-sm btn-outline-danger" id="removeImage" style="display: none">
                    Remove
                  </button>
                </div>
              </div>
            </div>
            <div class="mt-4">
              <button type="submit" class="btn btn-primary rounded-pill d-grid gap-2 col-6 mx-auto mt-3">
                Save Details
              </button>
              <button type="button" class="btn btn-danger rounded-pill d-grid gap-2 col-6 mx-auto mt-3" id="clearAll">
                Clear All
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="container mt-4 mb-5">
    <div class="row">
      <div class="col-lg-10 mx-auto">
        <div class="card">
          <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Profile Details</h5>
            <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#editModal">
              <i class="bi bi-pencil"></i>
            </button>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table mb-0">
                <tbody>
                  <tr>
                    <td colspan="4" class="fw-bold"><i class="bi bi-person"></i> Personal Information</td>
                  </tr>
                  <tr>
                    <td class="fw-semibold">Name:</td>
                    <td id="displayName">-</td>
                    <td class="fw-semibold">Email:</td>
                    <td id="displayEmail">-</td>
                  </tr>
                  <tr>
                    <td class="fw-semibold">Mobile:</td>
                    <td id="displayMobile">-</td>
                    <td class="fw-semibold">Gender:</td>
                    <td id="displayGender">-</td>
                  </tr>
                  <tr>
                    <td class="fw-semibold">Date of Birth:</td>
                    <td id="displayDOB">-</td>
                    <td class="fw-semibold">Age:</td>
                    <td id="displayAge">-</td>
                  </tr>
                  <tr>
                    <td colspan="4" class="fw-bold"><i class="bi bi-mortarboard"></i> Educational Information</td>
                  </tr>
                  <tr>
                    <td class="fw-semibold">College:</td>
                    <td id="displayCollege">-</td>
                    <td class="fw-semibold">Branch:</td>
                    <td id="displayBranch">-</td>
                  </tr>
                  <tr>
                    <td class="fw-semibold">Joining Date:</td>
                    <td id="displayJoining">-</td>
                    <td class="fw-semibold">Passing Year:</td>
                    <td id="displayPassing">-</td>
                  </tr>
                  <tr>
                    <td colspan="4" class="fw-bold"><i class="bi bi-geo-alt"></i> Address Information</td>
                  </tr>
                  <tr>
                    <td class="fw-semibold">Address:</td>
                    <td colspan="3" id="displayAddress">-</td>
                  </tr>
                  <tr>
                    <td class="fw-semibold">City:</td>
                    <td id="displayCity">-</td>
                    <td class="fw-semibold">State:</td>
                    <td id="displayState">-</td>
                  </tr>
                  <tr>
                    <td class="fw-semibold">Pincode:</td>
                    <td id="displayPincode">-</td>
                    <td class="fw-semibold">Country:</td>
                    <td id="displayCountry">-</td>
                  </tr>
                  <tr>
                    <td colspan="4" class="fw-bold"><i class="bi bi-heart"></i> Hobbies</td>
                  </tr>
                  <tr>
                    <td class="fw-semibold">Interests:</td>
                    <td colspan="3">
                      <div id="displayHobbies" class="d-flex flex-wrap gap-2">
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const profileAvatar = document.getElementById("profileAvatar");
    const imageInput = document.getElementById("imageUpload");
    const previewImage = document.getElementById("previewImage");
    const removeBtn = document.getElementById("removeImage");

    function getInitials(name) {
      return (
        name
          ?.split(" ")
          .map((n) => n[0])
          .join("")
          .toUpperCase() || "U"
      );
    }

    function populateFormFromLocalStorage() {
      const form = document.getElementById("profileForm");

      form.querySelector('[name="name"]').value = localStorage.getItem("userName") || "";
      form.querySelector('[name="email"]').value = localStorage.getItem("userEmail") || "";
      form.querySelector('[name="mobile"]').value = localStorage.getItem("userMobile") || "";
      form.querySelector('[name="college"]').value = localStorage.getItem("userCollege") || "";
      form.querySelector('[name="college_branch"]').value = localStorage.getItem("userBranch") || "";
      form.querySelector('[name="DOB"]').value = localStorage.getItem("userDOB") || "";
      form.querySelector('[name="age"]').value = localStorage.getItem("userAge") || "";
      form.querySelector('[name="clg_joining_date"]').value = localStorage.getItem("userJoining") || "";
      form.querySelector('[name="passing_year"]').value = localStorage.getItem("userPassing") || "";
      form.querySelector('[name="address"]').value = localStorage.getItem("userAddress") || "";
      form.querySelector('[name="city"]').value = localStorage.getItem("userCity") || "";
      form.querySelector('[name="state"]').value = localStorage.getItem("userState") || "";
      form.querySelector('[name="pincode"]').value = localStorage.getItem("userPincode") || "";
      form.querySelector('[name="country"]').value = localStorage.getItem("userCountry") || "";

      const gender = localStorage.getItem("userGender");
      if (gender) {
        const genderRadio = form.querySelector(`[name="gender"][value="${gender}"]`);
        if (genderRadio) genderRadio.checked = true;
      }

      const hobbies = JSON.parse(localStorage.getItem("userHobbies") || "[]");
      hobbies.forEach(hobby => {
        const hobbyCheckbox = form.querySelector(`[name="hobbies"][value="${hobby}"]`);
        if (hobbyCheckbox) hobbyCheckbox.checked = true;
      });

      const profileImage = localStorage.getItem("profileImage");
      if (profileImage) {
        previewImage.src = profileImage;
        previewImage.style.display = "block";
        removeBtn.style.display = "inline-block";
      }
    }

    document.getElementById("editModal").addEventListener("shown.bs.modal", function () {
      populateFormFromLocalStorage();
    });

    window.addEventListener("DOMContentLoaded", () => {
      const name = localStorage.getItem("userName") || "User";
      const email = localStorage.getItem("userEmail") || "user@example.com";
      const image = localStorage.getItem("profileImage");

      document.getElementById("profileName").textContent = name;
      document.getElementById("profileEmail").textContent = email;

      if (image) {
        profileAvatar.style.backgroundImage = `url(${image})`;
        profileAvatar.style.backgroundSize = "cover";
        profileAvatar.style.backgroundPosition = "center";
        profileAvatar.textContent = "";
        previewImage.src = image;
        previewImage.style.display = "block";
        removeBtn.style.display = "inline-block";
      } else {
        profileAvatar.textContent = getInitials(name);
      }
    });

    imageInput.addEventListener("change", function () {
      const file = this.files[0];
      if (file && file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const imageUrl = e.target.result;
          localStorage.setItem("profileImage", imageUrl);
          previewImage.src = imageUrl;
          previewImage.style.display = "block";
          removeBtn.style.display = "inline-block";
          profileAvatar.style.backgroundImage = `url(${imageUrl})`;
          profileAvatar.style.backgroundSize = "cover";
          profileAvatar.style.backgroundPosition = "center";
          profileAvatar.textContent = "";
        };
        reader.readAsDataURL(file);
      }
    });

    removeBtn.addEventListener("click", () => {
      localStorage.removeItem("profileImage");
      previewImage.style.display = "none";
      removeBtn.style.display = "none";
      const name = localStorage.getItem("userName") || "User";
      profileAvatar.style.backgroundImage = "";
      profileAvatar.textContent = getInitials(name);
    });

    document.getElementById("dob").addEventListener("change", function () {
      const dob = new Date(this.value);
      const today = new Date();
      let age = today.getFullYear() - dob.getFullYear();
      const m = today.getMonth() - dob.getMonth();
      if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
        age--;
      }
      document.getElementById("age").value = age;
    });

    document.getElementById("joining").addEventListener("change", function () {
      const year = new Date(this.value).getFullYear();
      if (year) document.getElementById("passing").value = year + 4;
    });

    function loadUserData() {
      const urlParams = new URLSearchParams(window.location.search);
      const userId = urlParams.get('id');

      if (userId) {
        fetch('data.json')
          .then(res => res.json())
          .then(data => {
            const user = data.find(u => u.id == userId);
            if (user) {
              displayUserData(user);
              populateForm(user);
            }
          })
          .catch(err => console.error('Error loading user data:', err));
      } else {
        const userData = {
          name: localStorage.getItem("userName") || "User",
          email: localStorage.getItem("userEmail") || "user@example.com",
          mobile: localStorage.getItem("userMobile") || "-",
          gender: localStorage.getItem("userGender") || "-",
          DOB: localStorage.getItem("userDOB") || "-",
          age: localStorage.getItem("userAge") || "-",
          college: localStorage.getItem("userCollege") || "-",
          college_branch: localStorage.getItem("userBranch") || "-",
          clg_joining_date: localStorage.getItem("userJoining") || "-",
          passing_year: localStorage.getItem("userPassing") || "-",
          address: localStorage.getItem("userAddress") || "-",
          city: localStorage.getItem("userCity") || "-",
          state: localStorage.getItem("userState") || "-",
          pincode: localStorage.getItem("userPincode") || "-",
          country: localStorage.getItem("userCountry") || "-",
          hobbies: JSON.parse(localStorage.getItem("userHobbies") || "[]")
        };
        displayUserData(userData);
      }
    }

    function displayUserData(user) {
      document.getElementById("displayName").textContent = user.name || "-";
      document.getElementById("displayEmail").textContent = user.email || "-";
      document.getElementById("displayMobile").textContent = user.mobile || "-";
      document.getElementById("displayGender").textContent = user.gender || "-";
      document.getElementById("displayDOB").textContent = user.DOB || "-";
      document.getElementById("displayAge").textContent = user.age || "-";
      document.getElementById("displayCollege").textContent = user.college || "-";
      document.getElementById("displayBranch").textContent = user.college_branch || "-";
      document.getElementById("displayJoining").textContent = user.clg_joining_date || "-";
      document.getElementById("displayPassing").textContent = user.passing_year || "-";
      document.getElementById("displayAddress").textContent = user.address || "-";
      document.getElementById("displayCity").textContent = user.city || "-";
      document.getElementById("displayState").textContent = user.state || "-";
      document.getElementById("displayPincode").textContent = user.pincode || "-";
      document.getElementById("displayCountry").textContent = user.country || "-";

      const hobbiesContainer = document.getElementById("displayHobbies");
      hobbiesContainer.innerHTML = "";
      if (user.hobbies && user.hobbies.length > 0) {
        user.hobbies.forEach(hobby => {
          const badge = document.createElement("span");
          badge.textContent = hobby;
          hobbiesContainer.appendChild(badge);
        });
      } else {
        hobbiesContainer.innerHTML = "<span class='text-muted'>No hobbies listed</span>";
      }
    }

    function populateForm(user) {
      const form = document.getElementById("profileForm");
      Object.keys(user).forEach(key => {
        const input = form.querySelector(`[name="${key}"]`);
        if (input) {
          if (input.type === 'radio') {
            const radio = form.querySelector(`[name="${key}"][value="${user[key]}"]`);
            if (radio) radio.checked = true;
          } else if (input.type === 'checkbox') {
            if (Array.isArray(user[key])) {
              user[key].forEach(value => {
                const checkbox = form.querySelector(`[name="${key}"][value="${value}"]`);
                if (checkbox) checkbox.checked = true;
              });
            }
          } else {
            input.value = user[key] || "";
          }
        }
      });
    }

    window.addEventListener("DOMContentLoaded", () => {
      loadUserData();
    });

    document.getElementById("profileForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const formData = new FormData(this);
      const hobbies = [];

      document.querySelectorAll('input[name="hobbies"]:checked').forEach(checkbox => {
        hobbies.push(checkbox.value);
      });

      localStorage.setItem("userName", formData.get("name") || "");
      localStorage.setItem("userEmail", formData.get("email") || "");
      localStorage.setItem("userMobile", formData.get("mobile") || "");
      localStorage.setItem("userGender", formData.get("gender") || "");
      localStorage.setItem("userDOB", formData.get("DOB") || "");
      localStorage.setItem("userAge", formData.get("age") || "");
      localStorage.setItem("userCollege", formData.get("college") || "");
      localStorage.setItem("userBranch", formData.get("college_branch") || "");
      localStorage.setItem("userJoining", formData.get("clg_joining_date") || "");
      localStorage.setItem("userPassing", formData.get("passing_year") || "");
      localStorage.setItem("userAddress", formData.get("address") || "");
      localStorage.setItem("userCity", formData.get("city") || "");
      localStorage.setItem("userState", formData.get("state") || "");
      localStorage.setItem("userPincode", formData.get("pincode") || "");
      localStorage.setItem("userCountry", formData.get("country") || "");
      localStorage.setItem("userHobbies", JSON.stringify(hobbies));

      document.getElementById("profileName").textContent = formData.get("name") || "User";
      document.getElementById("profileEmail").textContent = formData.get("email") || "user@example.com";

      const newName = formData.get("name");
      if (newName && !localStorage.getItem("profileImage")) {
        profileAvatar.textContent = getInitials(newName);
      }

      alert("Profile saved successfully!");
    });
    document.getElementById("clearAll").addEventListener("click", function () {
      if (confirm("Are you sure you want to clear all data?")) {
        localStorage.clear();
        alert("All data cleared!");
        window.location.href = "/";
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>